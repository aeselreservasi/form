<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="robots" content="none" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="stylesheet" type="text/css" href="./JFT_files/bootstrap-icons.css" />
    <link rel="stylesheet" type="text/css" href="./JFT_files/bootstrap.min.v5.3.0.css" />
    <link rel="stylesheet" href="./JFT_files/style_pr_responsive.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
    <link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/material_blue.css" />
    <title>Pilihan Tempat Ujian dan Tanggal</title>
    <style>
      /* Desain tombol pembungkus ikon */
      .calendarbuttonwrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background 0.2s ease-in-out;
      }

      #fullDatepicker {
        font-size: 2rem;
        cursor: pointer;
      }

      /* Memperbaiki posisi popup kalender agar tidak tertutup */
      .flatpickr-calendar {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15) !important;
        border: 1px solid #ddd !important;
      }
      /* Tombol yang tersedia */
      .btn.available {
        background-color: #ffffff;
        border: 1px solid #0d6efd;
        color: #000000;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn.available:hover {
        background-color: #0d6efd;
        color: #white;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      /* Tombol yang penuh (sudah ada di template Anda biasanya) */
      .btn.booked {
        background-color: #f8f9fa;
        color: #6c757d;
        border: 1px solid #dee2e6;
        cursor: not-allowed;
        opacity: 0.6;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid custom-header">
      <div class="container d-flex justify-content-between">
        <div><img src="./JFT_files/prometric_logo.jpg" alt="Prometric縺ｮ繝ｭ繧ｴ" class="custom-header-logo" /></div>
        <div>
          <button class="btn btn btn-teriary" type="button" name="Logout" onclick="javascript:Cancel()">
            <i class="bi bi-box-arrow-right"></i>
            Logout
          </button>
        </div>
      </div>
    </div>
    <script src="./08JFT_files/jquery-3.3.1.min.js.download"></script>

    <div class="title-default-block">
      <h1>Pilihan Tempat Ujian dan Tanggal</h1>
    </div>

    >
    <div class="container-fluid page-wrapper">
      <h3>Kriteria Pencarian</h3>
      <form name="form" method="post">
        <input type="hidden" name="isReloaded" value="" />
        <div class="row mb-3">
          <label for="birthYear" class="form-label">Tanggal ujian</label>
          <div class="d-flex">
            <div class="col-md-2 me-2">
              <input type="text" class="form-control" name="exam_day_y" id="exam_day_y" value="2026" placeholder="Tahun" />
            </div>
            <div class="col-md-2 me-2">
              <input type="text" class="form-control" name="exam_day_m" id="exam_day_m" value="01" placeholder="Bulan" />
            </div>
            <div class="col-md-2 me-2">
              <input type="text" class="form-control" name="exam_day_d" id="exam_day_d" value="15" placeholder="Tanggal" />
            </div>
            <div class="calendarbuttonwrapper" data-target="#datetimepicker1" data-toggle="datetimepicker" id="datetimepicker1">
              <i class="bi bi-calendar3" id="fullDatepicker" data-target="#fullDatepicker" data-toggle="fullDatepicker" title="Klik untuk melihat kalender"></i>
            </div>
          </div>
          <div class="inline-baloon-wrapper">
            <div class="inline-baloon">
              <span class="inline-arrow"></span>
              <p class="examday-note">
                Periode Reservasi yang Tersedia:
                <span class="text-danger fw-bold">2025/12/25 s/d 2026/01/15</span>
              </p>
            </div>
          </div>
          <input type="hidden" name="calendar_end" value="2026/01/15" />
          <input type="hidden" name="calendar_end_y" value="2026" />
          <input type="hidden" name="calendar_end_m" value="1" />
          <input type="hidden" name="calendar_end_d" value="15" />
        </div>

        <div class="mb-3" id="proctorRadioTR" style="display: none">
          <label for="exampleInputEmail1" class="form-label">CBT/IBT</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" id="test_center" name="examMethod" value="TestCenter" checked="" />
            <label class="form-check-label" for="test_center">CBT/Tempat Ujian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" id="proctor" name="examMethod" value="Proctor" />
            <label class="form-check-label" for="proctor">IBT/Online(ProProctor®︎)</label>
          </div>
        </div>

        <div class="row mb-3" id="countryTR">
          <div class="col-md-6 col-sm-12">
            <label for="exampleInputEmail1" class="form-label">Negara</label>
            <select class="form-select" aria-label="Default select example" name="countryCode" id="countryCode" onchange="ChangeAreaSelectBox()">
              <option value="" selected=""></option>
              <option value="IDN" selected="">Indonesia</option>
            </select>
          </div>
        </div>

        <div class="row mb-3" id="areaTR">
          <div class="col-md-6 col-sm-12">
            <label for="exampleInputEmail1" class="form-label">Wilayah</label>
            <select class="form-select" aria-label="Default select example" name="areaCode" id="areaCode">
              <option value="" selected=""></option>
              <option value="Z110"></option>
            </select>
          </div>
        </div>

        <div class="row mb-3" id="placeNameTR">
          <div class="col-md-6 col-sm-12">
            <label for="exampleInputEmail1" class="form-label">Nama Tempat</label>
            <input type="text" class="form-control" name="placeName" value="" />
          </div>
        </div>

        <div class="serchplace-button">
          <button type="button" class="btn btn-primary btn-lg w-100" id="serchplacebutton" name="search" onclick="reload();">
            <i class="bi bi-search"></i>
            Cari
          </button>
        </div>
        <div id="searchResultSection" style="display: none">
          <a name="result"></a>
          <h3>【Hasil Pencarian】</h3>
          <p class="selected-examday">Tanggal ujian 2026/01/15</p>

          <input type="HIDDEN" name="In_examstart" />
          <input type="HIDDEN" name="In_place_no" />
          <input type="HIDDEN" name="In_placeno" />
          <input type="HIDDEN" name="In_exam_day" value="2026/01/15" />
          <div class="time-table-note alert alert-light">
            <div class="d-flex flex-wrap flex-md-row">
              <div class="d-flex flex-row align-items-center legend-bt-wrapper">
                <div class="available-legend"></div>
                <div class="legend-text">Ada kursi</div>
              </div>
              <div class="d-flex flex-row align-items-center legend-bt-wrapper">
                <div class="limited-legend"></div>
                <div class="legend-text">Ada sedikit kursi</div>
              </div>
              <div class="d-flex flex-row align-items-center legend-bt-wrapper">
                <div class="booked-legend"></div>
                <div class="legend-text">Tidak dapat dipilih</div>
              </div>
              <div class="d-flex flex-row align-items-center legend-bt-wrapper">
                <div class="unavailable-legend"></div>
                <div class="legend-text">Tidak tersedia</div>
              </div>
            </div>
          </div>
          <p>Klik jam mulai dari tempat ujian yang Anda inginkan.</p>
        </div>
        <div id="resultsContainer"></div>
        <div>
          <button class="btn btn-secondary wid-180 margin-t-large" type="button" name="Return" onclick="javascript:history.back();">
            <i class="bi bi-caret-left-fill"></i>
            Kembali
          </button>
        </div>
        <input type="hidden" id="calendar_start" name="calendar_start" value="2025/12/24" />
        <input type="hidden" id="calendar_start_y" name="calendar_start_y" value="2025" />
        <input type="hidden" id="calendar_start_m" name="calendar_start_m" value="12" />
        <input type="hidden" id="calendar_start_d" name="calendar_start_d" value="24" />
      </form>
    </div>

    <div class="container-fluid custom-footer">
      <footer>
        <p class="copyright-text">© Prometric, ALL RIGHTS RESERVED.</p>
      </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Inisialisasi Flatpickr pada ikon
        flatpickr("#fullDatepicker", {
          disableMobile: "true", // Memaksa tampilan kalender desktop di HP
          dateFormat: "Y-m-d",
          // Mengatur posisi popup agar muncul di bawah ikon
          position: "auto center",
          onChange: function (selectedDates, dateStr, instance) {
            if (selectedDates.length > 0) {
              const date = selectedDates[0];

              // Ambil Tahun, Bulan (01-12), Tanggal (01-31)
              const year = date.getFullYear();
              const month = String(date.getMonth() + 1).padStart(2, "0");
              const day = String(date.getDate()).padStart(2, "0");

              // Isi otomatis ke 3 input teks Anda
              document.getElementById("exam_day_y").value = year;
              document.getElementById("exam_day_m").value = month;
              document.getElementById("exam_day_d").value = day;
            }
          },
        });
      });
    </script>
    <script>
      async function reload() {
        // 1. Definisikan variabel input terlebih dahulu
        const year = document.getElementById("exam_day_y").value;
        const month = document.getElementById("exam_day_m").value;
        const day = document.getElementById("exam_day_d").value;
        const selectedDate = `${year}/${month}/${day}`;
        const keyword = document.querySelector('input[name="placeName"]').value.toLowerCase().trim();

        // 2. Munculkan section hasil & update teks tanggal
        const searchSection = document.getElementById("searchResultSection");
        searchSection.style.display = "block";
        document.querySelector(".selected-examday").innerText = "Tanggal ujian " + selectedDate;

        // 3. Setup URL API (Gunakan backtick ` tanpa teks "const apiUrl =" di dalamnya)
        const apiUrl = `https://script.google.com/macros/s/AKfycbwstG1W9Hb7xnJ288prwbtV7_NzTdAYxDNUEdZwIYSJxal6yx65Ylcha8IhfU5FyuJh/exec?token=JFT2026_SUPER_SECRET_KEY_99&date=${selectedDate}&loc=${encodeURIComponent(
          keyword,
        )}`;

        const container = document.getElementById("resultsContainer");
        container.innerHTML = '<div class="text-center my-3"><div class="spinner-border text-primary"></div><p>Memuat jadwal...</p></div>';

        try {
          const response = await fetch(apiUrl);
          const data = await response.json();

          container.innerHTML = ""; // Bersihkan teks loading
          let found = false;

          // Karena filter sudah dilakukan di Server (Apps Script),
          // kita tinggal melakukan render data yang datang.
          data.forEach((item) => {
            found = true;

            const headerHtml = `
          <div class="row-header place-name">
              <i class="bi bi-geo-alt-fill"></i>
              <a href="javascript:void(0)" onclick="joukyo_1('${item.locId}')">${item.locName}</a>
          </div>`;

            let buttonsHtml = '<div class="time-table">';
            const timeArray = String(item.times).split(";");

            timeArray.forEach((timeRaw) => {
              let time = timeRaw.trim();
              if (time !== "") {
                if (time.endsWith("*")) {
                  let cleanTime = time.replace("*", "");
                  //buttonsHtml += `<button type="button" class="btn available" onclick="window.location.href='https://tenor.com/search/creepy-disturbing-gifs'">${cleanTime}</button> `;
                  buttonsHtml += `<button type="button" class="btn available" onclick="click_next('${item.locId}','${cleanTime}','2')">${cleanTime}</button> `;
                } else {
                  buttonsHtml += `<button type="button" class="btn booked" disabled>${time}</button> `;
                }
              }
            });
            buttonsHtml += "</div>";

            container.innerHTML += headerHtml + buttonsHtml;
          });

          if (!found) {
            container.innerHTML = '<div class="alert alert-warning">Tidak ada jadwal ditemukan untuk tanggal dan lokasi tersebut.</div>';
          }

          // Scroll halus ke arah hasil
          document.querySelector('a[name="result"]').scrollIntoView({ behavior: "smooth" });
        } catch (error) {
          console.error("Detail Error:", error);
          container.innerHTML = '<div class="alert alert-danger">Gagal memuat data. Periksa koneksi atau URL Script.</div>';
        }
      }
    </script>
  </body>
</html>
